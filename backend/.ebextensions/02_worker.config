option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    # Worker-specific configuration
    WORKER_CONCURRENCY_DETECTION: 2
    WORKER_CONCURRENCY_GROUPING: 1
    WORKER_CONCURRENCY_CLEANUP: 1
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "node dist/workers/index.js"
    NodeVersion: 18.x
  aws:autoscaling:launchconfiguration:
    # Workers need more CPU/memory for image processing
    InstanceType: t3.medium
  # Disable nginx for worker tier (not needed)
  aws:elasticbeanstalk:environment:
    EnvironmentType: SingleInstance

commands:
  01_build:
    command: npm run build
    cwd: /var/app/staging
